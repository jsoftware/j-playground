# J Makefile for emscripten HTML
# run with cd ../../bin/html && python2 -c 'import SimpleHTTPServer; SimpleHTTPServer.test() 
# var jdox = Module.cwrap('jdox','string',['string'])
# jdox('i.10')

CC     = emcc 
CFLAGS = -m32 -DC_64=0
CFLAGS += -Wno-parentheses -Wno-unused-value -Wno-pointer-sign
CFLAGS += -Wno-empty-body -Wno-return-type -Wno-constant-logical-operand
CFLAGS += -Wno-comment -Wno-string-plus-int -Wno-unsequenced  -fomit-frame-pointer -D __linux__=1
CFLAGS += -D HTML=1


SRCS=$(wildcard *.c)

OBJ=$(SRCS:.c=.o)

j      : $(OBJ)
	  mkdir -p ../../bin/html 
	  $(CC) $(CFLAGS) $(OBJ) -o ../../bin/html/emj.html  -s BINARYEN_EXTRA_PASSES="--pass-arg=max-func-params@61" \
	  -s WASM=1 -s EMULATE_FUNCTION_POINTER_CASTS=1 -s EXPORTED_FUNCTIONS='["_main","_em_jdo"]' \
	  -s EXTRA_EXPORTED_RUNTIME_METHODS='["cwrap","ccall"]' -s NO_EXIT_RUNTIME=1 -s ALLOW_MEMORY_GROWTH=1 \
	  --extern-post-js extra.js

clean:;	rm -f $(OBJ) j

$(OBJ) : $(HDR)
